<div class="container">
  <p>chord one</p>
  <input>
  <p>chord two</p>
  <input>
  <button id="button1">start</button>
	<button id="button2">stop</button>
	<br> 
	<input type="range" id="bpm" min="60" max="150" step="5" value="0">
</div>

<style>
  p {
    text-align: center;
  }
  
  .container {
    background: #FFCDCB;
    border: 1px #806867 solid;
    width: 245px;
    height: 300px;
    position: absolute;
    left: 50px;
    top: 50px;
    border-radius: 30px;
  }
  
  button {
    background: #FFE7CB;
    color: #806867;
    border: 1px #806867 solid;
    height: 50px;
    width: 100px;
    border-radius: 20px;
    font-size: 20px;
    margin: 10px;
  }
  
	button:hover {
  	box-shadow: 0px 0px 10px 2px #EAAEAB;
	}
  
  input {
    width: 220px;
    margin: 10px;
  }
</style>


<script src="https://tonejs.github.io/build/Tone.js"></script>
<script>
  /* global Tone */  
  // const notes = ['C4', 'E4', 'G4', 'A4', 'F4', 'C4', 'G4', 'E4']
  
  function noteToFrequency(note) {
  	return Tone.Frequency(note).toFrequency();
	}
  
  const C1 = noteToFrequency('C1')
	const C4 = noteToFrequency('C4')
  const E2 = noteToFrequency('E2')
  const E4 = noteToFrequency('E4')
  const G4 = noteToFrequency('G4')
  const A3 = noteToFrequency('A3')
  
  const chord1 = [C4, E4, G4]
  const chord2 = [A3, C4, E4]
  
  //calculate next chord
  function fibo (note1, note2) {
    //const ran = Math.random() * 0.5 + 1.5
    return (note1 + note2) / 2
  }
  
  const chord3 = [fibo(chord1[0], chord2[0]), fibo(chord1[1], chord2[1]), fibo(chord1[2], chord2[2])]
  const chord4 = [fibo(chord2[0], chord3[0]), fibo(chord2[1], chord3[1]), fibo(chord2[2], chord3[2])]
  const chord5 = [fibo(chord3[0], chord4[0]), fibo(chord3[1], chord4[1]), fibo(chord3[2], chord4[2])]  
  const chord6 = [fibo(chord4[0], chord5[0]), fibo(chord4[1], chord5[1]), fibo(chord4[2], chord5[2])]
  const chords = [...chord1, ...chord2, ...chord3, ...chord4, ...chord5, ...chord6]
  console.log(chords)
  
  let i = 0
  
  function play () {
    const autoWah = new Tone.AutoWah(50, 6, -30).toDestination()
    const synth = new Tone.AMSynth().connect(autoWah)
    autoWah.Q.value = 5
    synth.oscillator.type = 'fatsawtooth'
    synth.triggerAttackRelease(chords[i % chords.length], '8n')
    i++
  }
  
  const drums = [C1, 1, 1]
  
  function drum () {
    const chorus = new Tone.Chorus(4, 2.5, 0.5).toDestination().start()
    const drum = new Tone.MembraneSynth().connect(chorus)
    drum.triggerAttackRelease(drums[i % drums.length], '16n')
    i++
  }
  
  function start () {
    Tone.Transport.cancel()
    Tone.Transport.scheduleRepeat(play, '8n')
    Tone.Transport.scheduleRepeat(drum, '8n')
    Tone.Transport.bpm.value = 60 //speed 
    Tone.Transport.start()
    console.log("music!")
  }
  
  function stop () {
    Tone.Transport.stop()
    console.log("no music!")
  }

  const toggle = document.querySelector('#bpm')
  toggle.addEventListener('input', () => { 
    Tone.Transport.bpm.value = toggle.value 
  })
    
  const button1 = document.querySelector('#button1')
  const button2 = document.querySelector('#button2')
  
  button1.addEventListener('click', start)
  button2.addEventListener('click', stop)
  
</script>